"use strict";(()=>{var e={};e.id=527,e.ids=[527],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3932:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>u,staticGenerationAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>c,POST:()=>d,PUT:()=>p});var s=t(9303),n=t(8716),i=t(670),o=t(7070),l=t(728);async function c(){try{let e=(await l._.matches.findMany({orderBy:{match_date:"desc"},include:{player_matches:{include:{players:!0}}}})).map(e=>({match_id:e.match_id,match_date:e.match_date.toISOString(),team_a_score:e.team_a_score,team_b_score:e.team_b_score,created_at:e.created_at.toISOString(),player_matches:e.player_matches.map(e=>({player_match_id:e.player_match_id,player_id:e.player_id,match_id:e.match_id,team:e.team,goals:e.goals,clean_sheet:e.clean_sheet,heavy_win:e.heavy_win,heavy_loss:e.heavy_loss,result:e.result,fantasy_points:e.fantasy_points,players:e.players?{player_id:e.players.player_id,name:e.players.name,join_date:e.players.join_date.toISOString(),is_ringer:e.players.is_ringer,is_retired:e.players.is_retired}:null}))}));return o.NextResponse.json({data:e})}catch(e){return o.NextResponse.json({error:"Failed to fetch matches",details:e},{status:500})}}async function d(e){try{let a=await e.json();console.log("Received request body:",a);let{match_date:t,team_a_score:r,team_b_score:s,players:n}=a,i=n.map(e=>{let a="A"===e.team,t=a?r:s,n=a?s:r,i=Math.abs(r-s);return e.is_retired?null:{player_id:parseInt(e.player_id),team:e.team,goals:e.goals,clean_sheet:0===n,heavy_win:t>n&&i>=4,heavy_loss:t<n&&i>=4,result:t>n?"win":t<n?"loss":"draw"}}).filter(Boolean),c=await l._.$transaction(async e=>{let a=await e.matches.create({data:{match_date:new Date(t),team_a_score:r,team_b_score:s}});return await e.player_matches.createMany({data:i.map(e=>({match_id:a.match_id,...e}))}),a});return o.NextResponse.json({data:c})}catch(e){return console.error("Error creating match:",e),o.NextResponse.json({error:"Failed to create match",details:e.message},{status:500})}}async function p(e){try{let{match_id:a,match_date:t,team_a_score:r,team_b_score:s,players:n}=await e.json(),i=n.map(e=>{let a="A"===e.team,t=a?r:s,n=a?s:r,i=Math.abs(r-s);return e.is_retired?null:{player_id:e.player_id,team:e.team,goals:e.goals,clean_sheet:0===n,heavy_win:t>n&&i>=4,heavy_loss:t<n&&i>=4,result:t>n?"win":t<n?"loss":"draw"}}).filter(Boolean),c=await l._.$transaction(async e=>{let n=await e.matches.update({where:{match_id:a},data:{match_date:new Date(t),team_a_score:r,team_b_score:s}});return await e.player_matches.deleteMany({where:{match_id:a}}),await e.player_matches.createMany({data:i.map(e=>({match_id:a,...e}))}),n});return o.NextResponse.json({data:c})}catch(e){return o.NextResponse.json({error:"Failed to update match",details:e},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/matches/route",pathname:"/api/admin/matches",filename:"route",bundlePath:"app/api/admin/matches/route"},resolvedPagePath:"C:\\Users\\Ian\\BerkoTNF\\src\\app\\api\\admin\\matches\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:u}=m,y="/api/admin/matches/route";function w(){return(0,i.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:h})}},728:(e,a,t)=>{t.d(a,{_:()=>s});let r=require("@prisma/client"),s=global.prisma||new r.PrismaClient({log:["query"]})}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[948,972],()=>t(3932));module.exports=r})();